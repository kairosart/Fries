
#Attakiing_machine 
Create a file called `users.txt` with the users: `dale` and `administrator`. One per line.


### Kerberos user validation (quiet & fast)

```
~/tools/./kerbrute_linux_amd64 userenum -d fries.htb --dc <MACIINE IP> users.txt
```

![[kerbrute.png]]

Special success for `administrator`.


### AS-REP Roasting (VERY likely here)

Since users never logged in and may have:

> **â€œDo not require Kerberos preauthenticationâ€**

#Attakiing_machine 
Run:
```
impacket-GetNPUsers fries.htb/ -dc-ip <MACHINE IP> -usersfile users.txt
```

![[getnNPusers.png]]

#### What that `GetNPUsers` output means

`KDC_ERR_C_PRINCIPAL_UNKNOWN (Client not found in Kerberos database)`

This usually happens when **the username format or realm is wrong**, _or_ the user truly isnâ€™t a Kerberos principal in that form.

Common causes:

- Wrong realm casing
- Wrong username format
- Trying users that exist in Gitea but **arenâ€™t AD principals**


---


`User administrator doesn't have UF_DONT_REQUIRE_PREAUTH set`

This is **important and final**:

> âŒ **AS-REP roasting is NOT possible for `administrator`**

So AS-REP is **dead for this box**. Thatâ€™s not a failure â€” it just narrows the path.

---

#### âœ… What is CONFIRMED now

- AD **exists**
- Kerberos **exists**
- `administrator` **is a valid AD user**
- Pre-auth **is required**
- No anonymous LDAP
- No AS-REP roast

So the attack path is now **credentials acquisition**, not misconfig abuse.


## Fix the Kerberos user check (sanity step)

Before spraying, letâ€™s be 100% sure about usernames.

### Try explicit realm + single user

### Administrator user

```
impacket-GetNPUsers FRIES.HTB/administrator -dc-ip <MACHINE IP>
```

![[getnNPusers_administrator.png]]

#### Line by line ğŸ‘‡

 âœ…`Cannot authenticate administrator, getting its TGT`

This just means:
- You **did not provide a password**
- Impacket is attempting an **AS-REQ** (normal Kerberos behavior)

This line appears **for every user** when testing AS-REP roasting.

---

 âŒ `User administrator doesn't have UF_DONT_REQUIRE_PREAUTH set`

This is the **key result**:

> ğŸ”’ The `administrator` account **REQUIRES Kerberos pre-authentication**

Which means:

- âŒ **AS-REP roasting is NOT possible**
- âŒ No hash is returned
- âŒ This path is **closed by design**

So:

âœ… The user **exists**  
âŒ The user is **not vulnerable**


### Dale user

```
impacket-GetNPUsers FRIES.HTB/dale -dc-ip <MACHINE IP>
```

![[getnNPusers_dale.png]]
## Critical conclusion

`KDC_ERR_C_PRINCIPAL_UNKNOWN`

â¡ï¸ `dale` does NOT exist in Active Directory

### Meaning

- `dale` exists **only in Gitea**
- `administrator` exists in **AD**
- Gitea is **NOT using LDAP auth for users**
- Gitea users are **local accounts**

So:  
âŒ Kerberos spray on `dale` â†’ pointless  
âŒ AD attack surface is **administrator only**

---

#### What this implies architecturally

You have **two identity systems**:

|Service|Auth Source|
|---|---|
|AD / Kerberos / LDAP|Active Directory|
|Gitea|**Local database**|

That means:

- Gitea creds â‰  AD creds
- Breaking Gitea is **mandatory** before AD

**Next step:**  [[Gitea attack]]
