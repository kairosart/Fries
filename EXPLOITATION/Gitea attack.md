âœ… How Gitea login actually works (important)

Gitea login:

- Uses **CSRF tokens**
- Returns **HTTP 200 on failure**
- Error message is usually:
    - `Username or password is incorrect`
    - or rendered dynamically (not raw text)
- Sets cookies even on failure
    
So a naÃ¯ve `http-post-form` **will always lie**.

---

## âœ… Correct ways to attack Gitea login


### ğŸ¥‡ Option 1 â€” Manual testing (BEST here)

#Attakiing_machine 
Because you only have one user (`dale`), this is fastest and safest.

Try manually in browser:

 dale / Welcome1
 dale / TwinPeaks
 dale / Coffee123
 dale / Fries123! 
 dale / Spring2025!`

Watch for:

- Redirect to `/`
- New menu items
- Session cookie persists after refresh

---

### ğŸ¥ˆ Option 2 â€” Hydra with correct failure string (iffy)

First, get the **real error text**:

```
curl -s -X POST http://code.fries.htb/user/login \ -d "user_name=dale&password=wrong" | grep -i incorrect
```

Youâ€™ll likely see:

`Username or password is incorrect`

Then use:

```
hydra -l dale -P passwords.txt code.fries.htb http-post-form \ "/user/login:user_name=^USER^&password=^PASS^:Username or password is incorrect" \ -t 1 -W 5
```

![[hydra.png]]

âš ï¸ Still unreliable due to CSRF.

What youâ€™re seeing **is not a real credential win**. Itâ€™s a **classic Hydra false positive** caused by the way the failure condition is defined.

---

## Why Hydra says â€œ1 valid password foundâ€ (but prints none)

This line is the giveaway:

`[80][http-post-form] host: code.fries.htb   login: dale`

ğŸ”´ **No password is shown**.

That means Hydra believes **one attempt did NOT match the failure string**, so it flags it as â€œvalidâ€ â€” **even though authentication did not succeed**.

---

## Root cause (important)

Your Hydra command uses:

`:Username or password is incorrect`

But Gitea **does not always return that exact string**.

Gitea login can return:

- CSRF errors
- Redirects (302)
- Rate-limit messages
- Generic HTML without the error text
- Same page with different wording

â¡ï¸ When Hydra doesnâ€™t see the exact failure string, it assumes success.

Thatâ€™s exactly what happened here.

---

## Proof itâ€™s a false positive

You already confirmed:

- âŒ UI login fails
- âŒ No session cookie is created
- âŒ No redirect to `/`
- âŒ No repo access
- âŒ Git auth does not work
- âŒ LDAP / Kerberos auth fails

If the password were real, **at least one of those would succeed**.


## How to correctly test Gitea with Hydra (CSRF-aware)

Gitea uses a **CSRF token**, so blind Hydra wonâ€™t work reliably.

You _must_ include:

- `_csrf` token
- Cookies
- Redirect handling

Example (correct approach):

```
hydra -l dale -P passwords.txt code.fries.htb http-post-form \ "/user/login:user_name=^USER^&password=^PASS^&_csrf=^CSRF^:Invalid username or password" \ -H "Cookie: i_like_gitea=XYZ; _csrf=^CSRF^"
```

â€¦but this is **painful and unreliable**, and HTB does **not** expect brute-force here.

---

## Bottom line (important conclusion)

âœ”ï¸ You **do NOT** have valid credentials  
âœ”ï¸ Hydra result is a **false positive**  
âœ”ï¸ This is **intentional HTB misdirection**

So we move on â€” and thatâ€™s the correct play.

---

## Where this box is actually going (next attack surface)

You already proved:

- Gitea users exist
- Accounts are **inactive**
- No repos
- No auth bypass
- No LDAP bind

ğŸ‘‰ That means **Gitea is a red herring**, not the entry point.

### The real foothold is almost certainly:

- The main website (`fries.htb`)
- A **backend API**
- Or **service bound to localhost** (common HTB pattern)

**Next step:** [[Enumerating some ports]]